{
  "version": 3,
  "sources": [
    "C:/Users/Justin/AppData/Roaming/npm/node_modules/ksana-cli/node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "index.js",
    "src/main.jsx",
    "src/utils.js",
    "../node_modules/ksana2015-dualfilter/dualfilter.js",
    "../node_modules/ksana2015-dualfilter/index.js",
    "../node_modules/ksana2015-htmlfileopener/htmlfileopener.js",
    "../node_modules/ksana2015-htmlfileopener/index.js",
    "../node_modules/ksana2015-webruntime/downloader.js",
    "../node_modules/ksana2015-webruntime/html5fs.js",
    "../node_modules/ksana2015-webruntime/ksanagap.js",
    "../node_modules/ksana2015-webruntime/livereload.js",
    "../node_modules/ksana2015-webruntime/mkdirp.js"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjEA;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpEA;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "var React=require(\"react\");\r\nvar ReactDOM=require(\"react-dom\");\r\nrequire(\"ksana2015-webruntime/livereload\")(); \r\nvar ksanagap=require(\"ksana2015-webruntime/ksanagap\");\r\nksanagap.boot(\"dualfilter-sample\",function(){\r\n\tvar Main=React.createElement(require(\"./src/main.jsx\"));\r\n\tksana.mainComponent=ReactDOM.render(Main,document.getElementById(\"main\"));\r\n});",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar ksa=require(\"ksana-simple-api\");\r\nvar DualFilter=require(\"ksana2015-dualfilter\").Component;\r\nvar HTMLFileOpener=require(\"ksana2015-htmlfileopener\").Component;\r\nvar utils=require(\"./utils\");\r\nvar db=\"gcd\";\r\nvar styles={\r\n  container:{display:\"flex\"}\r\n  ,dualfilter:{flex:1,height:\"100%\",overflowY:\"auto\"}\r\n  ,rightpanel:{flex:3}\r\n  ,input:{fontSize:\"100%\",width:\"100%\"}\r\n  ,bodytext:{outline:0}\r\n  ,link:{cursor:\"pointer\",borderBottom:\"1px solid blue\"}\r\n  ,selectedLink:{cursor:\"pointer\",background:\"yellow\"}\r\n  ,title:{fontFamily:\"DFKai-SB\"}\r\n}\r\nvar maincomponent = React.createClass({displayName: \"maincomponent\",\r\n  getInitialState:function() {\r\n    return {items:[],hits:[],itemclick:\" \",text:\"\",q:\"\",uti:\"\",localmode:false,ready:false,links:[],\r\n    tofind1:localStorage.getItem(\"tofind1\")||\"ག$\",q:localStorage.getItem(\"q\")||\"དག\"};\r\n  }\r\n  ,componentDidMount:function() {\r\n    ksa.tryOpen(db,function(err){\r\n      if (!err) {\r\n        this.setState({ready:true});\r\n      } else {\r\n        this.setState({localmode:true});\r\n      }\r\n    }.bind(this));\r\n  }\r\n  ,onFilter:function(tofind1,q) {\r\n    ksa.filter({db:db,regex:tofind1,q:q},function(err,items){\r\n      localStorage.setItem(\"tofind1\",tofind1);\r\n      localStorage.setItem(\"q\",q);\r\n      this.setState({items:items,q:q,tofind1:tofind1},function(){\r\n        this.fetchText(items[0]);\r\n      }.bind(this));\r\n    }.bind(this));\r\n  }\r\n  ,fetchText:function(uti){\r\n    ksa.fetch({db:db,uti:uti,q:this.state.q},function(err,content){\r\n      if (!content || !content.length) return;\r\n      this.setState({uti:uti,text:content[0].text,hits:content[0].hits,text2:\"\",link:\"\",links:[]},function(){\r\n        this.refs.bodytext.contentEditable=true;\r\n      }.bind(this));  \r\n    }.bind(this));\r\n  }\r\n  ,fetchText2:function(uti){\r\n    if (!uti)return;\r\n    ksa.fetch({db:db,uti:uti},function(err,content){\r\n      if (!content || !content.length) return;\r\n      this.setState({link:uti,text2:content[0].text});\r\n    }.bind(this));\r\n  }\r\n  ,onItemClick:function(e) {\r\n    this.fetchText(e.target.innerHTML);\r\n  }\r\n  ,renderText:function() {\r\n    return ksa.renderHits(this.state.text,this.state.hits,E.bind(null,\"span\"));\r\n  }\r\n  ,onFileReady:function(files) {\r\n    this.setState({localmode:false,ready:true});\r\n    db=files[db];//replace dbid with HTML File handle\r\n  }\r\n  ,renderOpenKDB:function() {\r\n    if (!this.state.localmode)return React.createElement(\"div\", null, \"Loading \", db);\r\n    return React.createElement(\"div\", null, \r\n      React.createElement(\"h2\", null, \"Dual Filter DEMO for Moedict\"), \r\n      React.createElement(HTMLFileOpener, {onReady: this.onFileReady}), \r\n      React.createElement(\"br\", null), \"Google Chrome Only\", \n      React.createElement(\"br\", null), React.createElement(\"a\", {target: \"_new\", href: \"https://github.com/ksanaforge/dualfilter-sample\"}, \"Github Repo\")\r\n    )\r\n  }\r\n  ,bodytextmouseup:function(e) {\r\n    var offset=utils.getCaretCharacterOffsetWithin(this.refs.bodytext);\r\n    var cursortext=this.state.text.substr(offset).match(/[\\u0f40-\\u0fff]*/);\r\n    if (!cursortext)return;\r\n    var res=utils.tryEntry(db,cursortext[0],function(res){\r\n      this.setState({links:res});\r\n      this.fetchText2(res[0]);\r\n    }.bind(this));\r\n  }\r\n  ,golink:function(e) {\r\n    this.fetchText2(e.target.innerHTML);\r\n  }\r\n  ,renderLink:function(item,idx) {\r\n    var style=(item===this.state.link)?styles.selectedLink:styles.link;\r\n    return React.createElement(\"span\", {key: idx}, React.createElement(\"span\", {style: style, onClick: this.golink}, item), \" \")\r\n  }\r\n  ,render: function() {\r\n    if (!this.state.ready) return this.renderOpenKDB();\r\n    return React.createElement(\"div\", {style: styles.container}, \r\n      React.createElement(\"div\", {style: styles.dualfilter}, \r\n        React.createElement(DualFilter, {items: this.state.items, hits: this.state.hits, \r\n          inputstyle: styles.input, \r\n          tofind1: this.state.tofind1, \r\n          tofind2: this.state.q, \r\n          onItemClick: this.onItemClick, \r\n          onFilter: this.onFilter})\r\n      ), \r\n      React.createElement(\"div\", {style: styles.rightpanel}, \r\n        React.createElement(\"h2\", {style: styles.title}, this.state.uti), \r\n        React.createElement(\"div\", {onMouseUp: this.bodytextmouseup, ref: \"bodytext\", style: styles.bodytext}, this.renderText()), \r\n        this.state.links.map(this.renderLink), \r\n        React.createElement(\"div\", {ref: \"bodytext2\"}, this.state.text2)\r\n      )\r\n    )    \r\n  }\r\n});\r\nmodule.exports=maincomponent;",
    "\r\n/* from http://stackoverflow.com/questions/4811822/get-a-ranges-start-and-end-offsets-relative-to-its-parent-container/4812022#4812022\r\n*/\r\nvar ksa=require(\"ksana-simple-api\");\r\nvar indexOfSorted = function (array, obj, near) { \r\n  var low = 0,\r\n  high = array.length;\r\n  while (low < high) {\r\n    var mid = (low + high) >> 1;\r\n    if (array[mid]==obj) return mid;\r\n    array[mid] < obj ? low = mid + 1 : high = mid;\r\n  }\r\n  if (near) return low;\r\n  else if (array[low]==obj) return low;else return -1;\r\n};\r\n/* find all possible entry after cursor*/\r\nvar tryEntry=function(db,cursortext,cb) {\r\n    var first=cursortext[0],out=[];\r\n    var segnames=ksa.get(db,\"segnames\",function(segnames){\r\n        var start=indexOfSorted(segnames,first,true);\r\n        while (true) {\r\n            var entry=segnames[start];\r\n            if (cursortext.length>entry.length && cursortext.substr(0,entry.length)===entry) {\r\n                out.push(entry);\r\n            }\r\n            if (start>=segnames.length || entry[0]!==first) break;\r\n            start++;\r\n        }\r\n        out.sort(function(a,b){return b.length-a.length});\r\n        cb(out);\r\n    });\r\n}\r\nvar getCaretCharacterOffsetWithin=function (element) {\r\n    var caretOffset = 0;\r\n    var doc = element.ownerDocument || element.document;\r\n    var win = doc.defaultView || doc.parentWindow;\r\n    var sel;\r\n    if (typeof win.getSelection != \"undefined\") {\r\n        sel = win.getSelection();\r\n        if (sel.rangeCount > 0) {\r\n            var range = win.getSelection().getRangeAt(0);\r\n            var preCaretRange = range.cloneRange();\r\n            preCaretRange.selectNodeContents(element);\r\n            preCaretRange.setEnd(range.endContainer, range.endOffset);\r\n            caretOffset = preCaretRange.toString().length;\r\n        }\r\n    } else if ( (sel = doc.selection) && sel.type != \"Control\") {\r\n        var textRange = sel.createRange();\r\n        var preCaretTextRange = doc.body.createTextRange();\r\n        preCaretTextRange.moveToElementText(element);\r\n        preCaretTextRange.setEndPoint(\"EndToEnd\", textRange);\r\n        caretOffset = preCaretTextRange.text.length;\r\n    }\r\n    return caretOffset;\r\n}\r\nmodule.exports={getCaretCharacterOffsetWithin:getCaretCharacterOffsetWithin,tryEntry:tryEntry};",
    "var React=require(\"react\");\r\nvar ReactList=require(\"react-list\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\n\r\nvar styles={\r\n  item:{cursor:\"pointer\"}\r\n}\r\nvar DualFilter=React.createClass({\r\n  getInitialState:function(){\r\n    return {tofind1:this.props.tofind1||\"\",tofind2:this.props.tofind2||\"\"};\r\n  }\r\n  ,componentDidMount:function() {\r\n    if (this.state.tofind1||this.state.tofind2) {\r\n      this.preparesearch();\r\n    }\r\n  }\r\n  ,getDefaultProps:function(){\r\n    return {items:[],hits:[],vpos:[]};\r\n  }\r\n  ,propTypes:{\r\n    items:PT.array.isRequired\r\n    ,hits:PT.array\r\n    ,vpos:PT.array\r\n    ,onFilter:PT.func.isRequired\r\n    ,onItemClick:PT.func.isRequired\r\n    ,inputstyle:PT.object\r\n    ,inputclass:PT.oneOfType([PT.string, PT.func])\r\n\r\n  }\r\n  ,renderItem:function(i,idx){\r\n    var hit=(this.props.hits[i]||[]).length||\"\";\r\n    var vpos=this.props.vpos[i]||0;\r\n    return E(\"div\",{key:idx,style:styles.item\r\n      ,\"data-vpos\":vpos\r\n      ,\"data-hit\":hit\r\n      ,onClick:this.props.onItemClick},this.props.items[i]);\r\n  }\r\n  ,preparesearch:function() {\r\n    clearTimeout(this.timer);\r\n    this.timer=setTimeout(function(){\r\n      this.props.onFilter(this.state.tofind1,this.state.tofind2);\r\n    }.bind(this),500);    \r\n  }\r\n  ,onChange1:function(e) {\r\n    this.setState({tofind1:e.target.value});\r\n    this.preparesearch();\r\n  }\r\n  ,onChange2:function(e) {\r\n    this.setState({tofind2:e.target.value});\r\n    this.preparesearch();\r\n  }\r\n\t,render:function() {\r\n    var Input=this.props.inputclass||\"input\";\r\n\t\treturn E(\"div\",null,\r\n      E(Input,{placeholder:\"regular expression\",style:this.props.inputstyle,value:this.state.tofind1,onChange:this.onChange1})\r\n      ,E(\"br\")\r\n      ,E(Input,{placeholder:\"full text search\",style:this.props.inputstyle,value:this.state.tofind2,onChange:this.onChange2})\r\n      ,E(\"br\")\r\n      ,E(\"span\",null,\"match count:\",this.props.items.length)\r\n      ,E(\"br\")\r\n      ,E(ReactList,{itemRenderer:this.renderItem,length:this.props.items.length})\r\n    )\r\n\t}\r\n})\r\nmodule.exports=DualFilter;",
    "module.exports={Component:require(\"./dualfilter\")};",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\nvar styles={\r\n\tready:{backgroundColor:\"green\",color:\"yellow\"}\r\n}\r\nvar getFilesFromKsanajs=function() {\r\n\tvar o={};\r\n\tksana.js.files.map(function(file){\r\n\t\tif (file.substr(file.length-4)!==\".kdb\") return;\r\n\t\tkdbid=file.substr(file.lastIndexOf(\"/\")+1);\r\n\t\tkdbid=kdbid.substr(0,kdbid.length-4);\r\n\r\n\t\to[kdbid]=file;\r\n\t});\r\n\treturn o;\r\n}\r\nvar HTMLFileOpener=React.createClass({\r\n\tpropTypes:{\r\n\t\tfiles:PT.object // { kdbid:url}\r\n\t\t,onReady:PT.func.isRequired\r\n\t}\r\n\t,getInitialState:function() {\r\n\t\treturn {ready:{} };\r\n\t}\r\n\t,renderStatus:function(kdbid,url) {\r\n\t\tif(this.state.ready[kdbid]){\r\n\t\t\treturn E(\"span\",{style:styles.ready},\"Ready\");\r\n\t\t} else {\r\n\t\t\treturn E(\"span\",null,E(\"a\",{href:url},\"Download \"));\r\n\t\t}\r\n\t}\r\n\t,renderFileStatus:function(){\r\n\t\tvar o=[];\r\n\t\tfor (var kdbid in this.props.files) {\r\n\t\t\tvar url=this.props.files[kdbid];\r\n\t\t\to.push(E(\"div\",{key:kdbid},kdbid+\".kdb \",this.renderStatus(kdbid,url)));\r\n\t\t}\r\n\t\treturn o;\r\n\t}\r\n\t,getDefaultProps:function(){\r\n\t\treturn {files:getFilesFromKsanajs()};\r\n\t}\r\n\t,openFile:function(e) {\r\n\t\tvar files=e.target.files;\r\n\t\tvar ready=this.state.ready;\r\n\t\tfor (var i=0;i<files.length;i++) {\r\n\t\t\tvar kdbid=files[i].name;\r\n\t\t\tkdbid=kdbid.substr(0,kdbid.length-4);\r\n\t\t\tif (this.props.files[kdbid]) {\r\n\t\t\t\tready[kdbid]=files[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Object.keys(ready).length==Object.keys(this.props.files).length) {\r\n\t\t\tthis.props.onReady(ready);\r\n\t\t}\r\n\t\tthis.setState({ready:ready});\r\n\t}\r\n\t,render:function() {\r\n\t\tvar opts={type:\"file\", accept:\".kdb\", onChange:this.openFile}\r\n\t\tif (Object.keys(this.props.files).length>1) opts.multiple=\"multiple\";\r\n    return E(\"div\",null\r\n    \t, this.renderFileStatus()\r\n    \t, E(\"input\",opts)\r\n    \t,\"click download if you don't have the kdb on your disk\"\r\n    );\r\n\t}\r\n});\r\nmodule.exports=HTMLFileOpener;",
    "module.exports={Component:require(\"./htmlfileopener\")};",
    "\r\nvar userCancel=false;\r\nvar files=[];\r\nvar totalDownloadByte=0;\r\nvar targetPath=\"\";\r\nvar tempPath=\"\";\r\nvar nfile=0;\r\nvar baseurl=\"\";\r\nvar result=\"\";\r\nvar downloading=false;\r\nvar startDownload=function(dbid,_baseurl,_files) { //return download id\r\n\tvar fs     = require(\"fs\");\r\n\tvar path   = require(\"path\");\r\n\r\n\t\r\n\tfiles=_files.split(\"\\uffff\");\r\n\tif (downloading) return false; //only one session\r\n\tuserCancel=false;\r\n\ttotalDownloadByte=0;\r\n\tnextFile();\r\n\tdownloading=true;\r\n\tbaseurl=_baseurl;\r\n\tif (baseurl[baseurl.length-1]!='/')baseurl+='/';\r\n\ttargetPath=ksanagap.rootPath+dbid+'/';\r\n\ttempPath=ksanagap.rootPath+\".tmp/\";\r\n\tresult=\"\";\r\n\treturn true;\r\n}\r\n\r\nvar nextFile=function() {\r\n\tsetTimeout(function(){\r\n\t\tif (nfile==files.length) {\r\n\t\t\tnfile++;\r\n\t\t\tendDownload();\r\n\t\t} else {\r\n\t\t\tdownloadFile(nfile++);\t\r\n\t\t}\r\n\t},100);\r\n}\r\n\r\nvar downloadFile=function(nfile) {\r\n\tvar url=baseurl+files[nfile];\r\n\tvar tmpfilename=tempPath+files[nfile];\r\n\tvar mkdirp = require(\"./mkdirp\");\r\n\tvar fs     = require(\"fs\");\r\n\tvar http   = require(\"http\");\r\n\r\n\tmkdirp.sync(path.dirname(tmpfilename));\r\n\tvar writeStream = fs.createWriteStream(tmpfilename);\r\n\tvar datalength=0;\r\n\tvar request = http.get(url, function(response) {\r\n\t\tresponse.on('data',function(chunk){\r\n\t\t\twriteStream.write(chunk);\r\n\t\t\ttotalDownloadByte+=chunk.length;\r\n\t\t\tif (userCancel) {\r\n\t\t\t\twriteStream.end();\r\n\t\t\t\tsetTimeout(function(){nextFile();},100);\r\n\t\t\t}\r\n\t\t});\r\n\t\tresponse.on(\"end\",function() {\r\n\t\t\twriteStream.end();\r\n\t\t\tsetTimeout(function(){nextFile();},100);\r\n\t\t});\r\n\t});\r\n}\r\n\r\nvar cancelDownload=function() {\r\n\tuserCancel=true;\r\n\tendDownload();\r\n}\r\nvar verify=function() {\r\n\treturn true;\r\n}\r\nvar endDownload=function() {\r\n\tnfile=files.length+1;//stop\r\n\tresult=\"cancelled\";\r\n\tdownloading=false;\r\n\tif (userCancel) return;\r\n\tvar fs     = require(\"fs\");\r\n\tvar mkdirp = require(\"./mkdirp\");\r\n\r\n\tfor (var i=0;i<files.length;i++) {\r\n\t\tvar targetfilename=targetPath+files[i];\r\n\t\tvar tmpfilename   =tempPath+files[i];\r\n\t\tmkdirp.sync(path.dirname(targetfilename));\r\n\t\tfs.renameSync(tmpfilename,targetfilename);\r\n\t}\r\n\tif (verify()) {\r\n\t\tresult=\"success\";\r\n\t} else {\r\n\t\tresult=\"error\";\r\n\t}\r\n}\r\n\r\nvar downloadedByte=function() {\r\n\treturn totalDownloadByte;\r\n}\r\nvar doneDownload=function() {\r\n\tif (nfile>files.length) return result;\r\n\telse return \"\";\r\n}\r\nvar downloadingFile=function() {\r\n\treturn nfile-1;\r\n}\r\n\r\nvar downloader={startDownload:startDownload, downloadedByte:downloadedByte,\r\n\tdownloadingFile:downloadingFile, cancelDownload:cancelDownload,doneDownload:doneDownload};\r\nmodule.exports=downloader;",
    "/* emulate filesystem on html5 browser */\r\nvar get_head=function(url,field,cb){\r\n\tvar xhr = new XMLHttpRequest();\r\n\txhr.open(\"HEAD\", url, true);\r\n\txhr.onreadystatechange = function() {\r\n\t\t\tif (this.readyState == this.DONE) {\r\n\t\t\t\tcb(xhr.getResponseHeader(field));\r\n\t\t\t} else {\r\n\t\t\t\tif (this.status!==200&&this.status!==206) {\r\n\t\t\t\t\tcb(\"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t};\r\n\txhr.send();\r\n}\r\nvar get_date=function(url,cb) {\r\n\tget_head(url,\"Last-Modified\",function(value){\r\n\t\tcb(value);\r\n\t});\r\n}\r\nvar get_size=function(url, cb) {\r\n\tget_head(url,\"Content-Length\",function(value){\r\n\t\tcb(parseInt(value));\r\n\t});\r\n};\r\nvar checkUpdate=function(url,fn,cb) {\r\n\tif (!url) {\r\n\t\tcb(false);\r\n\t\treturn;\r\n\t}\r\n\tget_date(url,function(d){\r\n\t\tAPI.fs.root.getFile(fn, {create: false, exclusive: false}, function(fileEntry) {\r\n\t\t\tfileEntry.getMetadata(function(metadata){\r\n\t\t\t\tvar localDate=Date.parse(metadata.modificationTime);\r\n\t\t\t\tvar urlDate=Date.parse(d);\r\n\t\t\t\tcb(urlDate>localDate);\r\n\t\t\t});\r\n\t\t},function(){\r\n\t\t\tcb(false);\r\n\t\t});\r\n\t});\r\n}\r\nvar download=function(url,fn,cb,statuscb,context) {\r\n\t var totalsize=0,batches=null,written=0;\r\n\t var fileEntry=0, fileWriter=0;\r\n\t var createBatches=function(size) {\r\n\t\tvar bytes=1024*1024, out=[];\r\n\t\tvar b=Math.floor(size / bytes);\r\n\t\tvar last=size %bytes;\r\n\t\tfor (var i=0;i<=b;i++) {\r\n\t\t\tout.push(i*bytes);\r\n\t\t}\r\n\t\tout.push(b*bytes+last);\r\n\t\treturn out;\r\n\t }\r\n\t var finish=function() {\r\n\t\t rm(fn,function(){\r\n\t\t\t\tfileEntry.moveTo(fileEntry.filesystem.root, fn,function(){\r\n\t\t\t\t\tsetTimeout( cb.bind(context,false) , 0) ;\r\n\t\t\t\t},function(e){\r\n\t\t\t\t\tconsole.log(\"failed\",e)\r\n\t\t\t\t});\r\n\t\t },this);\r\n\t };\r\n\t\tvar tempfn=\"temp.kdb\";\r\n\t\tvar batch=function(b) {\r\n\t\tvar abort=false;\r\n\t\tvar xhr = new XMLHttpRequest();\r\n\t\tvar requesturl=url+\"?\"+Math.random();\r\n\t\txhr.open('get', requesturl, true);\r\n\t\txhr.setRequestHeader('Range', 'bytes='+batches[b]+'-'+(batches[b+1]-1));\r\n\t\txhr.responseType = 'blob';\r\n\t\txhr.addEventListener('load', function() {\r\n\t\t\tvar blob=this.response;\r\n\t\t\tfileEntry.createWriter(function(fileWriter) {\r\n\t\t\t\tfileWriter.seek(fileWriter.length);\r\n\t\t\t\tfileWriter.write(blob);\r\n\t\t\t\twritten+=blob.size;\r\n\t\t\t\tfileWriter.onwriteend = function(e) {\r\n\t\t\t\t\tif (statuscb) {\r\n\t\t\t\t\t\tabort=statuscb.apply(context,[ fileWriter.length / totalsize,totalsize ]);\r\n\t\t\t\t\t\tif (abort) setTimeout( cb.bind(context,false) , 0) ;\r\n\t\t\t\t \t}\r\n\t\t\t\t\tb++;\r\n\t\t\t\t\tif (!abort) {\r\n\t\t\t\t\t\tif (b<batches.length-1) setTimeout(batch.bind(context,b),0);\r\n\t\t\t\t\t\telse                    finish();\r\n\t\t\t\t \t}\r\n\t\t\t \t};\r\n\t\t\t}, console.error);\r\n\t\t},false);\r\n\t\txhr.send();\r\n\t}\r\n\r\n\tget_size(url,function(size){\r\n\t\ttotalsize=size;\r\n\t\tif (!size) {\r\n\t\t\tif (cb) cb.apply(context,[false]);\r\n\t\t} else {//ready to download\r\n\t\t\trm(tempfn,function(){\r\n\t\t\t\t batches=createBatches(size);\r\n\t\t\t\t if (statuscb) statuscb.apply(context,[ 0, totalsize ]);\r\n\t\t\t\t API.fs.root.getFile(tempfn, {create: 1, exclusive: false}, function(_fileEntry) {\r\n\t\t\t\t\t\t\tfileEntry=_fileEntry;\r\n\t\t\t\t\t\tbatch(0);\r\n\t\t\t\t });\r\n\t\t\t},this);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nvar readFile=function(filename,cb,context) {\r\n\tAPI.fs.root.getFile(filename, {create: false, exclusive: false},function(fileEntry) {\r\n\t\tfileEntry.file(function(file){\r\n\t\t\tvar reader = new FileReader();\r\n\t\t\treader.onloadend = function(e) {\r\n\t\t\t\tif (cb) cb.call(cb,this.result);\r\n\t\t\t};\r\n\t\t\treader.readAsText(file,\"utf8\");\r\n\t\t});\r\n\t}, console.error);\r\n}\r\n\r\nfunction createDir(rootDirEntry, folders,  cb) {\r\n  // Throw out './' or '/' and move on to prevent something like '/foo/.//bar'.\r\n  if (folders[0] == '.' || folders[0] == '') {\r\n    folders = folders.slice(1);\r\n  }\r\n  rootDirEntry.getDirectory(folders[0], {create: true}, function(dirEntry) {\r\n    // Recursively add the new subfolder (if we still have another to create).\r\n    if (folders.length) {\r\n      createDir(dirEntry, folders.slice(1),cb);\r\n    } else {\r\n\t\t\tcb();\r\n\t\t}\r\n  }, cb);\r\n};\r\n\r\n\r\nvar writeFile=function(filename,buf,cb,context){\r\n\tvar write=function(fileEntry){\r\n\t\tfileEntry.createWriter(function(fileWriter) {\r\n\t\t\tfileWriter.write(buf);\r\n\t\t\tfileWriter.onwriteend = function(e) {\r\n\t\t\t\tif (cb) cb.apply(cb,[buf.byteLength]);\r\n\t\t\t};\r\n\t\t}, console.error);\r\n\t}\r\n\r\n\tvar getFile=function(filename){\r\n\t\tAPI.fs.root.getFile(filename, {exclusive:true}, function(fileEntry) {\r\n\t\t\twrite(fileEntry);\r\n\t\t}, function(){\r\n\t\t\t\tAPI.fs.root.getFile(filename, {create:true,exclusive:true}, function(fileEntry) {\r\n\t\t\t\t\twrite(fileEntry);\r\n\t\t\t\t});\r\n\r\n\t\t});\r\n\t}\r\n\tvar slash=filename.lastIndexOf(\"/\");\r\n\tif (slash>-1) {\r\n\t\tcreateDir(API.fs.root, filename.substr(0,slash).split(\"/\"),function(){\r\n\t\t\tgetFile(filename);\r\n\t\t});\r\n\t} else {\r\n\t\tgetFile(filename);\r\n\t}\r\n}\r\n\r\nvar readdir=function(cb,context) {\r\n\tvar dirReader = API.fs.root.createReader();\r\n\tvar out=[],that=this;\r\n\tdirReader.readEntries(function(entries) {\r\n\t\tif (entries.length) {\r\n\t\t\tfor (var i = 0, entry; entry = entries[i]; ++i) {\r\n\t\t\t\tif (entry.isFile) {\r\n\t\t\t\t\tout.push([entry.name,entry.toURL ? entry.toURL() : entry.toURI()]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tAPI.files=out;\r\n\t\tif (cb) cb.apply(context,[out]);\r\n\t}, function(){\r\n\t\tif (cb) cb.apply(context,[null]);\r\n\t});\r\n}\r\nvar getFileURL=function(filename) {\r\n\tif (!API.files ) return null;\r\n\tvar file= API.files.filter(function(f){return f[0]==filename});\r\n\tif (file.length) return file[0][1];\r\n}\r\nvar rm=function(filename,cb,context) {\r\n\tvar url=getFileURL(filename);\r\n\tif (url) rmURL(url,cb,context);\r\n\telse if (cb) cb.apply(context,[false]);\r\n}\r\n\r\nvar rmURL=function(filename,cb,context) {\r\n\twebkitResolveLocalFileSystemURL(filename, function(fileEntry) {\r\n\t\tfileEntry.remove(function() {\r\n\t\t\tif (cb) cb.apply(context,[true]);\r\n\t\t}, console.error);\r\n\t},  function(e){\r\n\t\tif (cb) cb.apply(context,[false]);//no such file\r\n\t});\r\n}\r\nfunction errorHandler(e) {\r\n\tconsole.error('Error: ' +e.name+ \" \"+e.message);\r\n}\r\nvar initfs=function(grantedBytes,cb,context) {\r\n\twebkitRequestFileSystem(PERSISTENT, grantedBytes,  function(fs) {\r\n\t\tAPI.fs=fs;\r\n\t\tAPI.quota=grantedBytes;\r\n\t\treaddir(function(){\r\n\t\t\tAPI.initialized=true;\r\n\t\t\tcb.apply(context,[grantedBytes,fs]);\r\n\t\t},context);\r\n\t}, errorHandler);\r\n}\r\nvar init=function(quota,cb,context) {\r\n\tnavigator.webkitPersistentStorage.requestQuota(quota,\r\n\t\t\tfunction(grantedBytes) {\r\n\t\t\t\tinitfs(grantedBytes,cb,context);\r\n\t\t}, errorHandler\r\n\t);\r\n}\r\nvar queryQuota=function(cb,context) {\r\n\tvar that=this;\r\n\tnavigator.webkitPersistentStorage.queryUsageAndQuota(\r\n\t function(usage,quota){\r\n\t\t\tinitfs(quota,function(){\r\n\t\t\t\tcb.apply(context,[usage,quota]);\r\n\t\t\t},context);\r\n\t});\r\n}\r\nvar API={\r\n\tinit:init\r\n\t,readdir:readdir\r\n\t,checkUpdate:checkUpdate\r\n\t,rm:rm\r\n\t,rmURL:rmURL\r\n\t,getFileURL:getFileURL\r\n\t,writeFile:writeFile\r\n\t,readFile:readFile\r\n\t,download:download\r\n\t,get_head:get_head\r\n\t,get_date:get_date\r\n\t,get_size:get_size\r\n\t,getDownloadSize:get_size\r\n\t,queryQuota:queryQuota\r\n}\r\nmodule.exports=API;\r\n",
    "var appname=\"installer\";\r\nif (typeof ksana==\"undefined\") {\r\n\twindow.ksana={platform:\"chrome\"};\r\n\tif (typeof process!==\"undefined\" && \r\n\t\tprocess.versions && process.versions[\"node-webkit\"]) {\r\n\t\twindow.ksana.platform=\"node-webkit\";\r\n\t}\r\n}\r\nvar switchApp=function(path) {\r\n\tvar fs=require(\"fs\");\r\n\tpath=\"../\"+path;\r\n\tappname=path;\r\n\tdocument.location.href= path+\"/index.html\"; \r\n\tprocess.chdir(path);\r\n}\r\nvar downloader={};\r\nvar rootPath=\"\";\r\n\r\nvar deleteApp=function(app) {\r\n\tconsole.error(\"not allow on PC, do it in File Explorer/ Finder\");\r\n}\r\nvar username=function() {\r\n\treturn \"\";\r\n}\r\nvar useremail=function() {\r\n\treturn \"\"\r\n}\r\nvar runtime_version=function() {\r\n\treturn \"1.4\";\r\n}\r\n\r\n//copy from liveupdate\r\nvar jsonp=function(url,dbid,callback,context) {\r\n  var script=document.getElementById(\"jsonp2\");\r\n  if (script) {\r\n    script.parentNode.removeChild(script);\r\n  }\r\n  window.jsonp_handler=function(data) {\r\n    if (typeof data==\"object\") {\r\n      data.dbid=dbid;\r\n      callback.apply(context,[data]);    \r\n    }  \r\n  }\r\n  window.jsonp_error_handler=function() {\r\n    console.error(\"url unreachable\",url);\r\n    callback.apply(context,[null]);\r\n  }\r\n  script=document.createElement('script');\r\n  script.setAttribute('id', \"jsonp2\");\r\n  script.setAttribute('onerror', \"jsonp_error_handler()\");\r\n  url=url+'?'+(new Date().getTime());\r\n  script.setAttribute('src', url);\r\n  document.getElementsByTagName('head')[0].appendChild(script); \r\n}\r\n\r\n\r\nvar loadKsanajs=function(){\r\n\r\n\tif (typeof process!=\"undefined\" && !process.browser) {\r\n\t\tvar ksanajs=require(\"fs\").readFileSync(\"./ksana.js\",\"utf8\").trim();\r\n\t\tdownloader=require(\"./downloader\");\r\n\t\tksana.js=JSON.parse(ksanajs.substring(14,ksanajs.length-1));\r\n\t\trootPath=process.cwd();\r\n\t\trootPath=require(\"path\").resolve(rootPath,\"..\").replace(/\\\\/g,\"/\")+'/';\r\n\t\tksana.ready=true;\r\n\t} else{\r\n\t\tvar url=window.location.origin+window.location.pathname.replace(\"index.html\",\"\")+\"ksana.js\";\r\n\t\tjsonp(url,appname,function(data){\r\n\t\t\tksana.js=data;\r\n\t\t\tksana.ready=true;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nloadKsanajs();\r\n\r\nvar boot=function(appId,cb) {\r\n\tif (typeof appId==\"function\") {\r\n\t\tcb=appId;\r\n\t\tappId=\"unknownapp\";\r\n\t}\r\n\tif (!ksana.js && ksana.platform==\"node-webkit\") {\r\n\t\tloadKsanajs();\r\n\t}\r\n\tksana.appId=appId;\r\n\tvar timer=setInterval(function(){\r\n\t\t\tif (ksana.ready){\r\n\t\t\t\tclearInterval(timer);\r\n\t\t\t\tcb();\r\n\t\t\t}\r\n\t\t});\r\n}\r\n\r\n\r\nvar ksanagap={\r\n\tplatform:\"node-webkit\",\r\n\tstartDownload:downloader.startDownload,\r\n\tdownloadedByte:downloader.downloadedByte,\r\n\tdownloadingFile:downloader.downloadingFile,\r\n\tcancelDownload:downloader.cancelDownload,\r\n\tdoneDownload:downloader.doneDownload,\r\n\tswitchApp:switchApp,\r\n\trootPath:rootPath,\r\n\tdeleteApp: deleteApp,\r\n\tusername:username, //not support on PC\r\n\tuseremail:username,\r\n\truntime_version:runtime_version,\r\n\tboot:boot\r\n}\r\nmodule.exports=ksanagap;",
    "var started=false;\r\nvar timer=null;\r\nvar bundledate=null;\r\nvar get_date=require(\"./html5fs\").get_date;\r\nvar checkIfBundleUpdated=function() {\r\n\tget_date(\"bundle.js\",function(date){\r\n\t\tif (bundledate &&bundledate!=date){\r\n\t\t\tlocation.reload();\r\n\t\t}\r\n\t\tbundledate=date;\r\n\t});\r\n}\r\nvar livereload=function() {\r\n\tif(window.location.origin.indexOf(\"//127.0.0.1\")===-1) return;\r\n\r\n\tif (started) return;\r\n\r\n\ttimer1=setInterval(function(){\r\n\t\tcheckIfBundleUpdated();\r\n\t},2000);\r\n\tstarted=true;\r\n}\r\n\r\nmodule.exports=livereload;",
    "function mkdirP (p, mode, f, made) {\r\n     var path = nodeRequire('path');\r\n     var fs = nodeRequire('fs');\r\n\t\r\n    if (typeof mode === 'function' || mode === undefined) {\r\n        f = mode;\r\n        mode = 0x1FF & (~process.umask());\r\n    }\r\n    if (!made) made = null;\r\n\r\n    var cb = f || function () {};\r\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\r\n    p = path.resolve(p);\r\n\r\n    fs.mkdir(p, mode, function (er) {\r\n        if (!er) {\r\n            made = made || p;\r\n            return cb(null, made);\r\n        }\r\n        switch (er.code) {\r\n            case 'ENOENT':\r\n                mkdirP(path.dirname(p), mode, function (er, made) {\r\n                    if (er) cb(er, made);\r\n                    else mkdirP(p, mode, cb, made);\r\n                });\r\n                break;\r\n\r\n            // In the case of any other error, just see if there's a dir\r\n            // there already.  If so, then hooray!  If not, then something\r\n            // is borked.\r\n            default:\r\n                fs.stat(p, function (er2, stat) {\r\n                    // if the stat fails, then that's super weird.\r\n                    // let the original error be the failure reason.\r\n                    if (er2 || !stat.isDirectory()) cb(er, made)\r\n                    else cb(null, made);\r\n                });\r\n                break;\r\n        }\r\n    });\r\n}\r\n\r\nmkdirP.sync = function sync (p, mode, made) {\r\n    var path = nodeRequire('path');\r\n    var fs = nodeRequire('fs');\r\n    if (mode === undefined) {\r\n        mode = 0x1FF & (~process.umask());\r\n    }\r\n    if (!made) made = null;\r\n\r\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\r\n    p = path.resolve(p);\r\n\r\n    try {\r\n        fs.mkdirSync(p, mode);\r\n        made = made || p;\r\n    }\r\n    catch (err0) {\r\n        switch (err0.code) {\r\n            case 'ENOENT' :\r\n                made = sync(path.dirname(p), mode, made);\r\n                sync(p, mode, made);\r\n                break;\r\n\r\n            // In the case of any other error, just see if there's a dir\r\n            // there already.  If so, then hooray!  If not, then something\r\n            // is borked.\r\n            default:\r\n                var stat;\r\n                try {\r\n                    stat = fs.statSync(p);\r\n                }\r\n                catch (err1) {\r\n                    throw err0;\r\n                }\r\n                if (!stat.isDirectory()) throw err0;\r\n                break;\r\n        }\r\n    }\r\n\r\n    return made;\r\n};\r\n\r\nmodule.exports = mkdirP.mkdirp = mkdirP.mkdirP = mkdirP;\r\n"
  ]
}